
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-icons/device-icons.html">
<link rel="import" href="../bower_components/iron-icons/image-icons.html">

<link rel="import" href="drone-theme.html">
<link rel="import" href="time-since.html">
<link rel="import" href="time-duration.html">

<dom-module id="drone-build-card">
	<template>
		<style include="drone-theme"></style>
		<style>
			:host > div {
				display: block;
				background: var(--status-running-color);
				color: #FFF;
				padding: 30px 40px;
				margin: 20px 0px;
				margin-top: 0px;
				border-radius:2px;
				min-height: 110px;
			}
			:host > div.success {
				background: var(--status-success-color);
			}
			:host > div.failure,
			:host > div.error {
				background: var(--status-failure-color);
			}

			:host div,
			:host p {
				font-size:15px;
				margin:0px;
			}

			:host .time {
				float: right;
			}

			:host div > em {
				font-style: normal;
				min-width:70px;
				display:inline-block;
			}

			:host p {
				overflow:hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}

			:host iron-icon ~ span {
				vertical-align:middle;
				line-height:24px;
			}

			:host iron-icon {
				vertical-align:middle;
				margin-right:8px;
				--iron-icon-width: 18px;
				--iron-icon-height: 18px;
			}

			:host .commit span {
				line-height: 22px;
				vertical-align: middle;
				display: inline-block;
			}

			:host .commit a {
				text-decoration: none;
				line-height: 22px;
				vertical-align: middle;
				margin-left: 8px;
				color: #EEE;
			}
		</style>
		<div class$="[[ build.status ]]">
			<div class="time">
				<div>
					<iron-icon icon="image:timelapse"></iron-icon>
					<span><time-duration seconds="[[ duration(build) ]]"></time-duration></span>
				</div>
				<div>
					<iron-icon icon="device:access-time"></iron-icon>
					<span><time-since unix="[[ build.finished_at ]]"></time-since></span>
				</div>
			</div>
			<div class="meta">
				<div class="commit">
					<em>Commit:</em>
					<span>[[ substr(build.commit) ]]</span>
					<a href="[[ build.link_url ]]" target="_blank">
						<iron-icon icon="icons:link"></iron-icon>
					</a>
				</div>
				<div><em>Branch:</em> [[ build.branch ]]</div>
				<div><em>Author:</em> [[ build.author ]]</div>
				<br/>
				<p>[[ build.message ]]</p>
			</div>
		</div>
	</template>

	<script>
		Polymer({
			is: "drone-build-card",
			properties: {
				build: {
					type: Object
				},
			},
			substr: function(str) {
				return str.substr(0, 8)
			},
			duration: function(build) {
				return build.finished_at - (build.started_at != 0 ? build.started_at : build.created_at);
			}
		});
	</script>
</dom-module>
