image: go1.3
git:
  path: github.com/drone/drone
env:
  - GOROOT=/usr/local/go
  - PATH=$PATH:$GOROOT/bin:$GOPATH/bin
script:
  - sudo add-apt-repository ppa:git-core/ppa 1> /dev/null 2> /dev/null
  - sudo apt-get update 1> /dev/null 2> /dev/null
  - sudo apt-get -y install git zip libsqlite3-dev sqlite3 rpm dpkg 1> /dev/null 2> /dev/null
  - gem install fpm
  - rbenv rehash
  - make deps
  - make test
  - make test_postgres
  - make test_mysql
  - make packages
services:
  - postgres
  - mysql
notify:
  email:
    recipients:
      - bschumac@cisco.com
publish:
  docker:
    dockerfile: ./Dockerfile
    docker_host: 172.17.42.1:2375
    docker_port: 2375
    docker_version: 1.4.1
    registry_login: true
    username: $$DOCKERHUB_USER
    password: $$DOCKERHUB_PASS
    email: npateriya@yahoo.com
    image_name: npateriyainsecure/ciscodrone
    push_latest: true
    when:
      owner: CiscoCloud




# new build script for 0.4 branch

build:
  image: golang:1.4.2
  environment:
    - GOPATH=/drone
  commands:
    - apt-get update 1> /dev/null 2> /dev/null
    - apt-get -y install libsqlite3-dev sqlite3 1> /dev/null 2> /dev/null
    - go get golang.org/x/tools/cmd/vet
    - go get golang.org/x/tools/cmd/cover
    - make deps
    - make test

