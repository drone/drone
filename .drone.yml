image: bradrydzewski/go:1.2
env:
  - GOROOT=/usr/local/go
  - GOPATH=$PWD/Godeps/_workspace:/var/cache/drone
  - PATH=$PWD/Godeps/_workspace/bin:/var/cache/drone/bin:$PATH
script:
  - sudo apt-get -y install libsqlite3-dev sqlite3 1> /dev/null 2> /dev/null
  # $GOPATH/src/github.com/drone/drone must be this repo
  - mkdir /var/cache/drone/src/github.com/drone
  - ln -sf /var/cache/drone/src/github.com/Clever/drone /var/cache/drone/src/github.com/drone/drone
  - make embed
  - make build-dist
  - make test
  - make dpkg
publish:
  github:
    branch: master
    script:
      - make embed
      - make release
    artifacts:
      - release
    tag: v$(cat VERSION)
    token: {{github_token}}
    user: Clever
    repo: drone
